{"version":3,"sources":["components/canvas/canvasViewer.component.ts"],"names":[],"mappings":"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","file":"canvasViewer.component.js","sourcesContent":["import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\r\nimport { Component, ViewChild, Input } from \"@angular/core\";\r\nimport { IResponse, IImageOptions } from \"../../models/viewModels\";\r\n//import 'js/tiff.js';\r\n//import { FormatReader } from \"../canvas/FormatReader\";\r\n@Component({\r\n    selector: \"canvas-viewer\",\r\n    templateUrl: \"/view/components/canvas/canvasViewer.component.html\"\r\n})\r\n\r\nexport class CanvasViewerComponent {\r\n    @ViewChild(\"imageViewer\") imageViewer;\n    context: CanvasRenderingContext2D;\n    reader: any;\r\n    @Input() public imagePath;\r\n    @Input() public options: IImageOptions;\r\n    @Input() public overlays;\r\n    // @Input() HTMLTitleElement = \"\";\r\n\r\n    curPos = { x: 0, y: 0 };\r\n    picPos = { x: 0, y: 0 };\r\n    mousePos = { x: 0, y: 0 };\n    onchange = () => {\n        var imageReader = new ImageReader();\r\n        this.options.zoom.value = 1.0;\r\n        this.options.rotate.value = 0;\r\n        this.curPos = { x: 0, y: 0 };\r\n        this.picPos = { x: 0, y: 0 };\n        let canvas = this.imageViewer.nativeElement;\n        this.context = canvas.getContext(\"2d\");\n        this.options.ctx = this.context;\n        var canvasSize = canvas.parentNode;\r\n        this.context.canvas.width = canvasSize.clientWidth;\r\n        this.context.canvas.height = 900;//canvasSize.clientHeight;\r\n        var resize = { height: canvasSize.clientHeight, width: canvasSize.clientWidth };\t\t\n        if (typeof (this.imagePath) === 'object') {\r\n            // Object type file\r\n            if (imageReader.IsSupported(this.imagePath.type)) {\r\n                // get object\r\n                this.reader = imageReader.CreateReader(this.imagePath.type, this.imagePath).create(this.imagePath, this.options, this.onloadeddata);\r\n                // Create image\r\n                //this.reader = decoder.create(this.imagePath, this.options, onload);\r\n            } else {\r\n                console.log(this.imagePath.type, ' not supported !');\r\n            }\r\n        } else if (typeof (this.imagePath) === 'string') {\n            this.reader = imageReader.CreateReader(\"image/jpeg\").create(this.imagePath, this.options, this.onloadeddata);//, $q, $timeout);\r\n        }\n        this.applyTransform();\r\n    }\n    ngAfterViewInit() {\n        this.onchange();\r\n    }\r\n    constructor() {\r\n\r\n    }\r\n    ngOnChanges() {\r\n        this.onchange();\r\n    }\r\n    onloadeddata = () => {\r\n        if (this.reader == null) {\r\n            return;\r\n        }\r\n\r\n        if (this.reader.rendered) {\r\n            this.applyTransform();\r\n        } else {\r\n            this.resizeTo(this.options.controls.fit);\r\n        }\r\n    }\r\n\r\n    zoom = (direction) => {\r\n    }\r\n    rotate = (direction) => {\r\n    }\r\n    resizeTo = (value) => {\r\n    }\r\n\r\n    applyTransform = () => {\r\n        if (this.reader == null) {\r\n            return;\r\n        }\r\n        if (!this.reader.rendered) {\r\n            return;\r\n        }\r\n        var options = this.options;\r\n        var canvas = this.context.canvas;\r\n        var centerX = this.reader.width * this.options.zoom.value / 2;\r\n        var centerY = this.reader.height * this.options.zoom.value / 2;\r\n        // Clean before draw\r\n        this.context.clearRect(0, 0, canvas.width, canvas.height);\r\n        // Save context\r\n        this.context.save();\r\n        // move to mouse position\r\n        this.context.translate((this.picPos.x + centerX), (this.picPos.y + centerY));\r\n        // Rotate canvas\r\n        this.context.rotate(options.rotate.value * Math.PI / 180);\r\n        // Go back\r\n        this.context.translate(- centerX, - centerY);\r\n        // Change scale\r\n        if (this.reader.isZoom)\r\n            this.context.scale(this.options.zoom.value, this.options.zoom.value);\r\n        if ((!this.options.controls.filmStrip) || (this.options.controls.totalPage == 1)) {\r\n            if (this.reader.img != null) {\r\n                this.context.drawImage(this.reader.img, 0, 0, this.reader.width, this.reader.height);\r\n                this.context.beginPath();\r\n                this.context.rect(0, 0, this.reader.width, this.reader.height);\r\n                this.context.lineWidth = 0.2;\r\n                this.context.strokeStyle = \"#000000\";\r\n                this.context.stroke();\r\n            }\r\n            // Draw image at correct position with correct scale\r\n            if (this.reader.data != null) {\r\n                this.context.putImageData(this.reader.data, this.picPos.x, this.picPos.y);\r\n                this.context.beginPath();\r\n                this.context.rect(0, 0, this.reader.width, this.reader.height);\r\n                this.context.lineWidth = 0.2;\r\n                this.context.strokeStyle = \"#000000\";\r\n                this.context.stroke();\r\n            }\r\n        } else {\r\n            if (this.reader.images != null) {\r\n                for (var i = 0; i < this.reader.images.length; i++) {\r\n                    var image = this.reader.images[i];\r\n                    // angular.forEach(this.reader.images, function (image) {\r\n                    this.context.drawImage(image, 0, 0, image.width, image.height);\r\n                    this.context.beginPath();\r\n                    this.context.rect(0, 0, image.width, image.height);\r\n                    this.context.lineWidth = 0.2;\r\n                    this.context.strokeStyle = \"#000000\";\r\n                    this.context.stroke();\r\n                    this.context.translate(0, image.height + 15);\r\n                }//);\r\n            }\r\n            // Draw image at correct position with correct scale\r\n            if (this.reader.data != null) {\r\n                var offsetY = 0;\r\n                for (var i = 0; i < this.reader.data.length; i++) {\r\n                    var data = this.reader.data[i];\r\n                    // angular.forEach(this.reader.data, function (data) {\r\n                    this.context.putImageData(data, this.picPos.x, this.picPos.y + offsetY);\r\n                    this.context.beginPath();\r\n                    this.context.rect(0, 0, this.reader.width, this.reader.height);\r\n                    this.context.lineWidth = 0.2;\r\n                    this.context.strokeStyle = \"#000000\";\r\n                    this.context.stroke();\r\n                    offsetY += this.reader.height + 15;\r\n                    this.context.translate(0, offsetY);\r\n                }//);\r\n            }\r\n        }\r\n        // Restore\r\n        this.context.restore();\r\n\r\n        // Draw overlays\r\n        if (this.overlays.length > 0) {\r\n            for (var i = 0; i < this.overlays.length; i++) {\r\n                var item = this.overlays[i];\r\n                //angular.forEach(this.overlays, function (item) {\r\n                this.context.save();\r\n                // move to mouse position\r\n                this.context.translate((this.picPos.x + centerX), (this.picPos.y + centerY));\r\n                // Rotate canvas\r\n                this.context.rotate(this.options.rotate.value * Math.PI / 180);\r\n                // Go back\r\n                this.context.translate(- centerX, - centerY);\r\n                // Change scale\r\n                this.context.scale(this.options.zoom.value, this.options.zoom.value);\r\n                // Start rect draw\r\n                this.context.beginPath();\r\n                this.context.rect((item.x), (item.y), item.w, item.h);\r\n                this.context.fillStyle = item.color;\r\n                this.context.globalAlpha = 0.4;\r\n                this.context.fill();\r\n                this.context.lineWidth = 1;\r\n                this.context.strokeStyle = item.color;\r\n                this.context.stroke();\r\n                this.context.restore();\r\n            }\r\n        }\r\n    }\r\n\r\n}"]}