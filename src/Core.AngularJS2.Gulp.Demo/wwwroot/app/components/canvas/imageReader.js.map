{"version":3,"sources":["components/canvas/imageReader.ts"],"names":[],"mappings":"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","file":"imageReader.js","sourcesContent":["function ImageReader() {\r\n    this.mimetype = [\r\n        \"image/png\",\r\n        \"image/jpeg\"\r\n    ];\r\n\r\n    // Is Tiff module present\r\n    if (typeof (Tiff) !== \"undefined\") {\r\n        // Remove it from list\r\n        this.mimetype.push(\"image/tif\");\r\n        this.mimetype.push(\"image/tiff\");\r\n    }\r\n\r\n}\r\n\r\nfunction response(e) {\r\n\r\n}\r\ndeclare var anno: any;\r\n\r\nImageReader.prototype = {\r\n\r\n    tiffReader: function (data, options, callback, overImage) {\r\n        if (options.controls.toolbar) {\r\n            options.controls.image = true;\r\n            options.controls.sound = false;\r\n        }\r\n        this.reader = new FileReader();\r\n        var vm = this;\r\n        vm.rendered = false;\r\n        vm.tiff = null;\r\n        vm.img = null;\r\n        vm.data = null;\r\n        vm.width = -1;\r\n        vm.height = -1;\r\n        vm.options = options;\r\n        vm.images = [];\r\n        vm.currentPage = -1;\r\n        vm.isZoom = true;\r\n\r\n        if (options.controls.enableOverlay)\r\n            vm.images.push(overImage);\r\n\r\n        this.refresh = function () {\r\n            \r\n            if (vm.reader.result == undefined)\r\n                return;\r\n            if (vm.tiff == null) {\r\n                vm.tiff = new Tiff({ buffer: vm.reader.result });\r\n                vm.options.controls.totalPage = vm.tiff.countDirectory();\r\n                vm.options.controls.numPage = 1;\r\n                vm.options.info = {\r\n                    width: vm.tiff.width(),\r\n                    height: vm.tiff.height(),\r\n                    compression: vm.tiff.getField(Tiff.Tag.COMPRESSION),\r\n                    document: vm.tiff.getField(Tiff.Tag.DOCUMENTNAME),\r\n                    description: vm.tiff.getField(Tiff.Tag.IMAGEDESCRIPTION),\r\n                    orientation: vm.tiff.getField(Tiff.Tag.ORIENTATION),\r\n                    xresolution: vm.tiff.getField(Tiff.Tag.XRESOLUTION),\r\n                    yresolution: vm.tiff.getField(Tiff.Tag.YRESOLUTION)\r\n                };\r\n            }\r\n\r\n            // Limit page number if upper\r\n            if (vm.options.controls.numPage > vm.options.controls.totalPage) {\r\n                vm.options.controls.numPage = vm.options.controls.totalPage;\r\n            }\r\n            // Set to correct page\r\n            if (vm.options.controls.filmStrip) {\r\n                vm.images = [];\r\n                for (var p = 0; p < vm.tiff.countDirectory(); p++) {\r\n                    vm.tiff.setDirectory(p);\r\n                    // Set only first page @TODO\r\n                    if (p == 0) {\r\n                        vm.width = vm.tiff.width();\r\n                        vm.height = vm.tiff.height();\r\n                    }\r\n                    vm.images[p] = new Image();\r\n                    vm.images[p].onload = function () {\r\n                        if (vm.images.length == 1) {\r\n                            vm.img = vm.images[0];\r\n                        }\r\n                        callback();\r\n                        vm.rendered = true;\r\n                    }\r\n                    vm.images[p].src = vm.tiff.toDataURL();\r\n                    vm.images[p].pageNum = p;\r\n                    //that.currentPage = that.options.controls.numPage;\r\n                }\r\n\r\n            } else {\r\n                if (vm.currentPage != vm.options.controls.numPage) {\r\n                    vm.tiff.setDirectory(vm.options.controls.numPage - 1);\r\n                    vm.width = vm.tiff.width();\r\n                    vm.height = vm.tiff.height();\r\n                    vm.img = new Image();\r\n                    vm.img.onload = function () {\r\n                        callback();\r\n                        vm.rendered = true;\r\n                    }\r\n                    vm.img.src = vm.tiff.toDataURL();\r\n                    options.ctx.drawImage(vm.img, 0, 0);\r\n                    //options.ctx.drawImage(vm.img, 111, 111);\r\n\r\n                    vm.currentPage = vm.options.controls.numPage;\r\n                }\r\n            }\r\n        };\r\n\r\n        this.reader.onload = function () {\r\n            if (vm.tiff != null) {\r\n                vm.tiff.close();\r\n                vm.tiff = null;\r\n            }\r\n            Tiff.initialize({ TOTAL_MEMORY: 16777216 * 5 });//100000000\r\n            vm.refresh();\r\n        };\r\n\r\n        if (typeof (data) == 'string') {\r\n            vm.img = new Image();\r\n            if (data.indexOf('Tiff') >= 0) {\r\n                var xhr = new XMLHttpRequest();\r\n                xhr.open(\"GET\", data);\r\n                xhr.responseType = \"arraybuffer\";\r\n              \r\n                xhr.onreadystatechange = function () {\r\n                    if (xhr.readyState == XMLHttpRequest.DONE) {\r\n                        var tiff = new Tiff({ buffer: xhr.response });\r\n                        vm.tiff = tiff;\r\n                        vm.width = vm.tiff.width();\r\n                        vm.height = vm.tiff.height();\r\n                        vm.img = new Image();\r\n                        vm.img.onload = function () {\r\n                            callback();\r\n                            vm.rendered = true;\r\n                        }\r\n                        vm.img.src = vm.tiff.toDataURL();\r\n                        //anno.makeAnnotatable(vm.img);\r\n\r\n                        //var base64 = base64ArrayBuffer(xhr.response);\r\n                        //that.img.src = base64;\r\n                        if (options.controls.enableOverlay) {\r\n                            let img2 = new Image();\r\n                            img2.src = overImage;\r\n\r\n                            options.ctx.drawImage(img2, 0,100,111,111,110,1111,111,111);\r\n                        }\r\n                        else\r\n                            options.ctx.drawImage(vm.img, 0, 0);\r\n\r\n                    }\r\n                }\r\n                xhr.send();\r\n            }\r\n            else\r\n                vm.img.src = data;\r\n        }\r\n        else\r\n            this.reader.readAsArrayBuffer(data);\r\n        return this;\r\n    },\r\n\r\n    imageReader: function (data, options, callback, overImage) {\r\n        if (options.controls.toolbar) {\r\n            options.controls.image = true;\r\n            options.controls.sound = false;\r\n        }\r\n        this.reader = new FileReader();\r\n        var vm = this;\r\n        vm.img = new Image();\r\n        vm.img.onload = function () {\r\n            vm.width = vm.img.width;\r\n            vm.height = vm.img.height;\r\n            callback();\r\n            vm.rendered = true;\r\n        }\r\n        vm.data = null;\r\n        vm.width = -1;\r\n        vm.height = -1;\r\n        options.info = {};\r\n        vm.isZoom = true;\r\n        vm.rendered = false;\r\n        this.reader.onload = function () {\r\n            vm.img.src = vm.reader.result;\r\n            options.ctx.drawImage(vm.img, 0, 0);\r\n        };\r\n        if (typeof (data) === 'string') {\r\n            vm.img.src = data;\r\n        } else {\r\n            this.reader.readAsDataURL(data);\r\n        }\r\n        // PNG or JPEG are one page only\r\n        options.controls.totalPage = 1;\r\n        options.controls.numPage = 1;\r\n        this.refresh = function () {\r\n            // do nothing\t\r\n        };\r\n        return this;\r\n    },\r\n\r\n    CreateReader: function (mimeType, obj) {\r\n        var reader = null;\r\n\r\n        if (mimeType == \"\") {\r\n            mimeType = this.GuessMimeType(obj);\r\n        }\r\n\r\n        switch (mimeType.toLowerCase()) {\r\n            case \"image/tif\":\r\n            case \"image/tiff\": reader = { create: this.tiffReader }; break;\r\n            case \"image/png\":\r\n            case \"image/jpg\":\r\n            case \"image/jpeg\": reader = { create: this.imageReader }; break;\r\n        };\r\n        return reader;\r\n    },\r\n    IsSupported: function (mimeType) {\r\n        return (this.mimetype.indexOf(mimeType) != -1);\r\n    },\r\n    GuessMimeType: function (fileName) {\r\n        // try to guess mime type if not available\r\n        var mimeType = \"\";\r\n        mimeType = \"image/\" + fileName.substring(fileName.indexOf('.') + 1);\r\n        return mimeType.toLowerCase();\r\n    },\r\n\r\n   \r\n}\r\n"]}